{"version":3,"sources":["theme.js"],"names":[],"mappings":"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","file":"theme.js","sourcesContent":["'use strict';\nimport when from 'when';\nimport Path from 'path';\nimport _ from 'lodash';\nimport File from 'fs-extra';\nimport elegantSpinner from 'elegant-spinner';\nimport logUpdate from 'log-update';\nimport Dir from './dir';\nimport 'source-map-support/register';\nlet frame = elegantSpinner();\n/**  \n * The class that locates themes  \n * @class Theme  \n */\nclass Theme {\n  constructor(options) {\n      if (options) {\n        // Check if Doc will be installing a theme\n        // or will be rendering a template\n        let resolved = {\n          theme: options.template.path ? undefined : Theme.findTheme(options)\n        };\n        // Set the options\n        this.options = {\n          theme: {\n            name: resolved.theme ?\n              resolved.theme.name : undefined,\n            path: resolved.theme ?\n              resolved.theme.path : undefined\n          },\n          output: {\n            path: options.output.path ?\n              options.output.path : options.output\n          },\n          template: {\n            name: options.package ?\n              options.package.name : '',\n            path: options.template.path,\n            isEnabled: options.template.isEnabled,\n            isKit: options.template.isKit\n          }\n        };\n      }\n    }\n    /**    \n     * Returns the tasks that install the theme    \n     * @private    \n     * @param options The options to install the themes    \n     * @return {object}    \n     */\n  static tasks(options) {\n      // Sources     \n      let config = {\n        src: (() => {\n          if (options.template.isEnabled() && !options.template.isKit())\n            return options.template.path;\n          else if (options.template.isEnabled())\n            return process.cwd();\n          else return options.theme.path;\n        })(),\n        dest: options.output.path,\n        paths: {\n          css: {\n            src: 'assets/css',\n            dest: 'css'\n          },\n          js: {\n            src: 'assets/js',\n            dest: 'js'\n          }\n        }\n      };\n      return {\n        /**        \n         * Shows the progress for each command        \n         */\n        showProgress: (command, max = 200) => {\n          var count = 0;\n          while (count < max) {\n            logUpdate('Mr. Doc [info]: ' + frame() + ' ' + command);\n            count++;\n          }\n        },\n        /**\n         * Create necessary paths to destination folder (Async)        \n         */\n        copyAssets: () => {\n          let types = _.keys(config.paths);\n          let m = when.map(types, function(type) {\n            let d = when.defer();\n            let src = Path.join(config.src, config.paths[type].src);\n            let dest = Path.join(config.dest, config.paths[type].dest);\n            File.copy(src, dest, {\n              clobber: true\n            }, error => {\n              if (error) d.reject(error);\n              else {\n                d.resolve();\n              }\n            });\n            return d.promise;\n          });\n          return m;\n        },\n        /**        \n         * Create necessary paths to destination folder (Sync)       \n         */\n        copyAssetsSync: () => {\n          let types = _.keys(config.paths);\n          _.forEach(types, type => {\n            let src = Path.join(config.src, config.paths[type].src);\n            let dest = Path.join(config.dest, config.paths[type].dest);\n            File.copySync(src, dest, {\n              clobber: true\n            });\n          });\n        },\n        /**        \n         * Reads the template from the source and strigifies it. (Async)        \n         */\n        stringifyTemplate: () => {\n          let d = when.defer();\n          let file = Path.join(config.src, 'template/index.jade');\n          File.readFile(file, (error, data) => {\n            if (error) d.reject(error);\n            else d.resolve({\n              template: data.toString()\n            });\n          });\n          return d.promise;\n        },\n        /**        \n         * Reads the template from the source and strigifies it. (Sync)        \n         */\n        stringifyTemplateSync: () => {\n          let file = Path.join(config.src, 'template/index.jade');\n          return File.readFileSync(file).toString();\n        }\n      };\n    }\n    /**    \n     * Find the theme specified    \n     * @param {String} theme The theme to find    \n     * @return {Object} The theme.    \n     */\n  static findTheme(options) {\n      const DEFAULT_THEME = 'mr-doc-theme-default';\n      const mrDocPath = Path.resolve(__dirname, '..');\n      const projectPath = process.cwd();\n      const name = options.theme.name;\n      // Plugins may provide a name property\n      // so just in case check it\n      const locations = {\n        // Path to the project's node_modules dir + theme       \n        project: Path.join(projectPath, 'node_modules', name),\n        // Path to Doc's node_modules dir + theme       \n        mrDoc: Path.join(mrDocPath, 'node_modules', name),\n        // Path to the Doc's default theme dir       \n        default: Path.join(mrDocPath, 'node_modules', DEFAULT_THEME)\n      };\n      if (Dir.exists(locations.mrDoc)) {\n        console.log('Mr. Doc [info]: Using theme [' + name + ']');\n        return {\n          name,\n          path: locations.mrDoc\n        };\n      } else if (Dir.exists(locations.project)) {\n        console.log('Mr. Doc [info]: Using theme [' + name + ']');\n        return {\n          name,\n          path: locations.project\n        };\n      } else {\n        console.log('Mr. Doc [warn]: Theme \"' + name + '\" not found, reverting to default.');\n        return {\n          name: DEFAULT_THEME,\n          path: locations.default\n        };\n      }\n    }\n    /**    \n     * Copies the theme specified (reverting to default)    \n     * over to the output directory. (Async)  \n     * @jsfiddle https://jsfiddle.net/iwatakeshi/k5xsvoez/embedded/\n     * @return {Function} The promise.    \n     */\n  install(options = this.options) {\n      let final = when.defer();\n      // Check if the template is enabled (legacy)       \n      if (options.template.isEnabled() &&\n        !options.template.isKit()) {\n        final.resolve({\n          template: File.readFileSync(Path.resolve(__dirname, options.template.path)).toString()\n        });\n\n      } else {\n        let tasks = Theme.tasks(options);\n        ((notify) => {\n          return tasks.copyAssets()\n            .tap(() => {\n              notify('Copying Assets.');\n            })\n            .then(tasks.stringifyTemplate)\n            .tap(() => {\n              notify('Rendering template.');\n            })\n            .then(final.resolve);\n        })(tasks.showProgress);\n      }\n      return final.promise;\n    }\n    /**      \n     * Copies the theme specified (reverting to default)    \n     * over to the output directory. (Sync)\n     * @jsfiddle https://jsfiddle.net/iwatakeshi/nLvz3g89/embedded/\n     * @return {String} The template    \n     */\n  installSync(options = this.options) {\n    var template;\n    if (options.template.isEnabled() &&\n      !options.template.isKit()) {\n      return {\n        template: File.readFileSync(Path.resolve(__dirname, options.template.path)).toString()\n      };\n    } else {\n      let tasks = Theme.tasks(options);\n      tasks.copyAssetsSync();\n      tasks.showProgress('Copying assets.');\n      template = tasks.stringifyTemplateSync();\n      tasks.showProgress('Reading template.');\n      tasks.showProgress('Done.');\n\n      return {\n        template\n      };\n    }\n  }\n}\nexport default Theme;"],"sourceRoot":"/source/"}